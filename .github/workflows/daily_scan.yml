name: Daily Stock Scanner

# 設定觸發時機
on:
  schedule:
    # GitHub 使用 UTC 時間。台灣是 UTC+8。
    # 下午 14:30 (台股收盤後) = UTC 06:30
    # 設定每天 UTC 06:30 執行
    - cron: '30 06 * * 1-5' # 1-5 代表週一到週五
  
  # 允許手動按按鈕觸發 (方便測試用)
  workflow_dispatch:

# 設定權限：允許這個 Action 修改儲存庫內容 (為了上傳 result.csv)
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Check out repository (下載程式碼)
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: Install dependencies (安裝套件)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run scanner script (執行 Python 掃描)
      run: python daily_scan.py

    - name: Commit and push if changes (將 CSV 上傳回 GitHub)
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add result.csv
        # 下面這行如果不加 || exit 0，當沒有新資料要 Commit 時會報錯
        git commit -m "Auto-update: Stock scan result" || exit 0
        git push
